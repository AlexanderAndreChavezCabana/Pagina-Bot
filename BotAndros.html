<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ChatBot Universidad UNASAM</title>

  <!-- Estilos propios -->
  <link rel="stylesheet" href="css/estilos.css">

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,700&display=swap" rel="stylesheet">

  <!-- Animaciones AOS -->
  <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">

  <!-- FontAwesome CDN -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
</head>

<body>
  <header>
    <nav>
      <section class="contenedor nav">
        <div class="logo">
          <img src="img/logo-jordan-alexander.png" alt="">
        </div>
        <div class="enlaces-header">
          <a href="#">Inicio</a>
          <a href="#">Inicio</a>
          <a href="#">Inicio</a>
          <a href="#">Inicio</a>
          <a href="#">Inicio</a>
        </div>
        <div class="hamburguer">
          <i class="fas fa-bars"></i>
        </div>
      </section>
    </nav>
    <div class="contenedor">
      <section class="contenido-header">
        <section class="textos-header">
          <h1>Our creativity is your success</h1>
          <p>Lorem, ipsum dolor sit amet consectetur adipisicing elit. Fugit, dolorum.</p>
          <a href="#">Learn more</a>
        </section>
        <img src="img/primeraIlustracion.svg" alt="">
      </section>
    </div>
  </header>

  <!-- Secciones de contenido -->
  <section class="about-us"> ... </section>
  <section class="questions contenedor"> ... </section>
  <section class="results"> ... </section>
  <section class="contenedor1 services"> ... </section>

  <footer>
    <div class="partFooter">
      <img src="img/logo-jordan-alexander.png" alt="">
    </div>
    <div class="partFooter">
      <h4>Servicios</h4>
      <a href="#">Services 1</a>
      <a href="#">Services 2</a>
      <a href="#">Services 3</a>
    </div>
    <div class="partFooter">
      <h4>Acerca de</h4>
      <a href="#">About 1</a>
      <a href="#">About 2</a>
      <a href="#">About 3</a>
    </div>
    <div class="partFooter">
      <h4>Redes sociales</h4>
      <div class="social-media">
        <i class="fab fa-facebook-f"></i>
        <i class="fab fa-twitter"></i>
        <i class="fab fa-instagram"></i>
        <i class="fab fa-youtube"></i>
      </div>
    </div>
  </footer>

  <!-- Estilos específicos para el widget -->

  <!-- Scripts -->
  <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

  <script src="js/main.js"></script>

  <!-- Script oficial de Dialogflow -->
  <script src="https://www.gstatic.com/dialogflow-console/fast/messenger/bootstrap.js?v=1"></script>

  <!-- Personalización del chatbot -->
  <script>
       $(document).ready(function() {
        window.addEventListener('dfMessengerLoaded', function (event) {
            const dfMessenger = document.querySelector('df-messenger'); 
            const style = document.createElement('style');
            $r1 = document.querySelector("df-messenger");
            $r2 = $r1.shadowRoot.querySelector("df-messenger-chat");
            $r3 = $r2.shadowRoot.querySelector("df-messenger-titlebar");
            $r4 = $r2.shadowRoot.querySelector("df-messenger-user-input");
            $r5 = $r2.shadowRoot.querySelector("df-message-list");
            $r6 = $r3.shadowRoot.querySelector("#dfTitlebar");
            $r7 = $r4.shadowRoot.querySelector(".input-container");
            $r8 = $r4.shadowRoot.querySelector(".input-container .input-box-wrapper");
            $r9 = $r4.shadowRoot.querySelector(".input-container .input-box-wrapper input");
            
                



            // Height
            const nonMobileMinWidth = 501; // Breakpoint where DF Messenger switches between mobile/non-mobile styles
            style.textContent = '@media screen and (min-width: ' + nonMobileMinWidth + 'px) { .chat-wrapper { max-height: 80%; }';
            dfMessenger.shadowRoot.querySelector('df-messenger-chat').shadowRoot.appendChild(style);

            // Color title
            var sheet = new CSSStyleSheet;
            sheet.replaceSync(`.title-wrapper {
                    background: linear-gradient(135deg, rgb(28, 68, 100) 0%, rgb(38, 78, 110) 100%);
                    background-size: 200% 200%;
                    box-shadow: rgba(0, 0, 0, 0.5) 0px 0px 10px;
                    color: rgb(255, 255, 255);
                    font-size: 22px;
                    font-weight: bold;
                    text-align: center;
                    text-shadow: rgba(0, 0, 0, 0.5) 2px 2px
                }`);
            
            $r3.shadowRoot.adoptedStyleSheets = [sheet];
            
            
            // OTRO APARTADO

            const imagen_bot = document.createElement('img');
            imagen_bot.src = 'https://firebasestorage.googleapis.com/v0/b/chatbotoge.appspot.com/o/ogechatbot.png?alt=media&token=d3846f07-18d8-49f6-a29b-0a84ba64674d';
            imagen_bot.width = 40;
            imagen_bot.height = 40;
            imagen_bot.style.transition = 'all 0.5s ease';
            
            $r6.insertAdjacentElement("beforebegin", imagen_bot);
            
            let angle = 0;
            let direction = 1;

            function rotateImage() {
                angle = angle + direction * 0.01;
                if (angle > 0.2 || angle < -0.2) {
                    direction = -direction; // Cambia la dirección cuando se alcanza cierto ángulo.
                }
                imagen_bot.style.transform = `rotate(${angle}rad)`;
                requestAnimationFrame(rotateImage);
            }

            // Añade un efecto de "hover" que hace que la imagen parezca que se levanta cuando se pasa el ratón sobre ella.
            imagen_bot.addEventListener('mouseover', function() {
                imagen_bot.style.transform = 'scale(1.2) rotate(' + angle + 'rad)';
            });

            imagen_bot.addEventListener('mouseout', function() {
                imagen_bot.style.transform = 'scale(1) rotate(' + angle + 'rad)';
            });

            rotateImage();

            // Div for microphone
            const div_microphone = document.createElement('div');
           //  div_microphone.textContent = "Ejemplo"; 
            div_microphone.style="border-top-color: black;background: rgb(240, 242, 247);margin: 0 auto; display: flex; justify-content: center; align-items: center;"
            
            $r7.insertAdjacentElement("afterend", div_microphone);
            
            // Span for microphone
            const span_text_bot = document.createElement('span');
            span_text_bot.textContent = "Chat online";
            span_text_bot.innerHTML += "&nbsp;";

            const enlace_oge = document.createElement('a');
            enlace_oge.href = "https://www.facebook.com/ogeunasamoficial/";
            enlace_oge.textContent = "OGE-UNASAM";  
            enlace_oge.style = "text-decoration:none";   
            enlace_oge.innerHTML += "&nbsp;";


            const btn_microphone = document.createElement('button');
            btn_microphone.style = "display:block; height: 40px; width: 40px; border-radius: 50px; background: white; border: 0; margin-top: 5px; margin-bottom: 5px";

            div_microphone.insertAdjacentElement("beforeend", span_text_bot);
            div_microphone.insertAdjacentElement("beforeend", enlace_oge);
            div_microphone.insertAdjacentElement("beforeend", btn_microphone);

            const imagen_microphone = document.createElement('img');
            imagen_microphone.src = 'https://firebasestorage.googleapis.com/v0/b/chatbotoge.appspot.com/o/microphone.png?alt=media&token=0992cc33-0b7e-4b53-8bf8-8d53fad0157a';
            imagen_microphone.width = 26;
            imagen_microphone.height = 26;
            imagen_microphone.style = "padding-top: 0px";

            btn_microphone.appendChild(imagen_microphone);

            // color sendIcon replace
            var sheet1 = new CSSStyleSheet;
            sheet1.replaceSync(`#sendIcon:hover { fill: white; }`);

            // color sendIcon insert
            var sheet3 = new CSSStyleSheet;
            sheet3.insertRule(`#sendIcon:hover { box-shadow: 1px 1px 2px 2px #ddd; transition: 400ms; border: 0.8px}`);

            // background user message insert
            var sheet5 = new CSSStyleSheet;
            sheet5.insertRule(`#messageList .message.user-message { color: white; background: linear-gradient(135deg, rgb(37, 71, 106), rgb(20, 105, 126)) } `);
            
            // background chat
            var sheet6 = new CSSStyleSheet;
            sheet6.insertRule(`#messageList { background: white; } `);
            
            // background bot message
            var sheet7 = new CSSStyleSheet;
            sheet7.insertRule(`#messageList .message.bot-message { color: rgb(6, 19, 43); background: rgb(240, 242, 247); } `);
            $r5.shadowRoot.adoptedStyleSheets = [sheet5, sheet6, sheet7];
            
            // AGREGAANDO
            // Crear la imagen y agregarla al final de cada mensaje del bot
            $r5.querySelectorAll('.bot-message').forEach((botMessage) => {
              const audioIcon = document.createElement('img');
              audioIcon.src = 'https://firebasestorage.googleapis.com/v0/b/chatbotoge.appspot.com/o/voz%2Fbot_voz.png?alt=media&token=80f770a9-3bc5-4a45-814e-f1d3a0b42463'; // Por favor, cambia esto a la URL de tu imagen
              audioIcon.style.cursor = 'pointer'; // Cambia el cursor al pasar el mouse sobre la imagen para indicar que es interactiva

              // Extraer el texto del mensaje del bot
              const messageText = botMessage.textContent || botMessage.innerText;

              audioIcon.addEventListener('click', () => {
                const speech = new SpeechSynthesisUtterance(messageText);
                window.speechSynthesis.speak(speech);
              });

              // Agregar el ícono de audio al final del mensaje del bot
              botMessage.appendChild(audioIcon);
            });
            //FIN AGREGANDO
            
            // color sendIcon insert
            var sheet2 = new CSSStyleSheet;
            sheet2.insertRule(`#sendIcon { background: linear-gradient(135deg, rgb(37, 71, 106) 0%, rgb(20, 105, 126) 100%); border-radius: 3px; box-shadow: 0.5px 0.5px 1.5px 1.5px #ddd;}`);
            $r4.shadowRoot.adoptedStyleSheets = [sheet1, sheet2, sheet3];
            
            
            
            /*
            var sheet4 = new CSSStyleSheet;
            sheet4.replaceSync(`button#widgetIcon { box-shadow: rgb(0 77 255 / 50%) 0px 4px 24px; }`);
            $r1.shadowRoot.adoptedStyleSheets = [sheet4];*/
            
            var sheet4 = new CSSStyleSheet;

            // Definir la animación y los estilos del botón
            const animationName = 'blink';
            const animationDefinition = `
                @keyframes ${animationName} {
                0% { box-shadow: rgb(28, 68, 100, 0.35) 0px 0px 9px, rgb(28, 68, 100, 0.40) 0px 0px 10px, rgb(28, 68, 100, 0.45) 0px 0px 9px; }
                50% { box-shadow: rgb(28, 68, 100, 0.20) 0px 0px 3px, rgb(28, 68, 100, 0.20) 0px 0px 3px, rgb(28, 68, 100, 0.20) 0px 0px 3px; }
                100% { box-shadow: rgb(28, 68, 100, 0.35) 0px 0px 9px, rgb(28, 68, 100, 0.40) 0px 0px 9px, rgb(28, 68, 100, 0.45) 0px 0px 9px; }
            }`;
            const buttonStyle = `
                button#widgetIcon {
                    background: linear-gradient(135deg, rgb(28, 68, 100) 0%, rgb(38, 78, 110) 100%) 0% 0% / 200% 200%;
                    border: none;
                    box-shadow: rgb(28, 68, 100, 0.35) 0px 0px 9px, rgb(28, 68, 100, 0.4) 0px 0px 9px, rgb(28, 68, 100, 0.45) 0px 0px 9px;
                    animation: ${animationName} 4s linear infinite;
            }`;

            // Agregar la animación y los estilos al stylesheet
            // sheet4.replaceSync(animationDefinition + buttonStyle);
            // Definir la animación de giro
            const rotateAnimationName = 'rotateY';
            const rotateAnimationDefinition = `
                @keyframes ${rotateAnimationName} {
                    0%, 40% { transform: rotateY(0deg); }
                    60%, 100% { transform: rotateY(180deg); }
                }`;

            // Agregar la animación al botón
            const buttonRotateStyle = `
                button#widgetIcon {
                    animation: ${animationName} 5s linear infinite, ${rotateAnimationName} 50s linear infinite;
            }`;

            // Agregar la nueva animación y los estilos al stylesheet
            sheet4.replaceSync(animationDefinition + buttonStyle + rotateAnimationDefinition + buttonRotateStyle);

            $r1.shadowRoot.adoptedStyleSheets = [sheet4];
            
            // AGREGAANNNNNNNNNNDOOOOOOOOOOOOOOO
            const audioIcon = document.createElement('img');
            audioIcon.src = 'https://firebasestorage.googleapis.com/v0/b/chatbotoge.appspot.com/o/voz%2Fbot_voz.png?alt=media&token=80f770a9-3bc5-4a45-814e-f1d3a0b42463'; // Por favor, cambia esto a la URL de tu imagen
            audioIcon.style.cursor = 'pointer'; // Cambia el cursor al pasar el mouse sobre la imagen para indicar que es interactiva

            audioIcon.addEventListener('click', () => {
              const speech = new SpeechSynthesisUtterance(messageText);
              window.speechSynthesis.speak(speech);
            });
            
            // FIN AGREGANNNNNNNNNNNNNDOOOOOOOOOOOOOOOOOOOOOOO
            
            //btn micro
            btn_microphone.addEventListener('click',function(){
                var speech = true;
                window.SpeechRecognition = window.webkitSpeechRecognition;

                const recognition = new SpeechRecognition();
                recognition.lang = "es-PE"
                recognition.interimResults = true;
                
                recognition.addEventListener('result', e => {
                    const transcript = Array.from(e.results)
                        .map(result => result[0])
                        .map(result => result.transcript)
                        .join('')

                   
                    $r9.value = transcript;
                    $r8.className = "input-box-wrapper valid";
                    $r9.focus();
                    console.log(transcript);
                });
                
                if (speech == true) {
                    recognition.start();
                    btn_microphone.style = "display:block; height: 40px; width: 40px; border-radius: 50px; border: 0; margin-top: 5px; margin-bottom: 5px; background: linear-gradient(135deg, rgb(37, 71, 106, 0.7) 0%, rgb(20, 105, 126, 0.7) 100%); ";
                }

                recognition.onend = () => {
                    btn_microphone.style = "display:block; height: 40px; width: 40px; border-radius: 50px; background: white; border: 0; margin-top: 5px; margin-bottom: 5px";
                    var ev = document.createEvent('Event');
                    ev.initEvent('keypress');
                    ev.which = ev.keyCode = 13;
                    $r9.dispatchEvent(ev);
                
                };
            })

        });

    });


  </script>

<div class="container">
    <script src="https://www.gstatic.com/dialogflow-console/fast/messenger/bootstrap.js?v=1"></script>
    <df-messenger intent="WELCOME" chat-title="test" agent-id="" language-code="en" chat-icon="vest.jpg">
      <style>
        .container {
          background-image: url("img.png");
          background-repeat: no-repeat;
          min-height: 940px;
          height: 100%;
          margin: 10px 30px;
        }

        df-messenger {
          --df-messenger-bot-message: #fff;
          --df-messenger-button-titlebar-color: #0041C2;
          --df-messenger-button-titlebar-color: #0041C2;
          --df-messenger-chat-background-color: #fafafa;
          --df-messenger-font-color: #000;
          --df-messenger-send-icon: #00adff;
          --df-messenger-user-message: #0041C2;
          --df-messenger-chip-border-color:#0041C2;
        }
      </style>
    </df-messenger>

  </div>
</body>
</html>




